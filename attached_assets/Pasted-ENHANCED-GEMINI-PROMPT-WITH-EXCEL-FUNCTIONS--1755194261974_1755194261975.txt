ENHANCED GEMINI PROMPT WITH EXCEL FUNCTIONS
================================================================================
Analyze these documents and determine their format. Either "Excel", "Word", or "PDF".

Documents to analyze:
[
  {
    "id": "248c40bb-c1ec-4f20-ab21-7649dee682ec",
    "name": "Ersatz eighth (1).xlsx",
    "type": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
    "contentPreview": "=== Sheet: New_Pensioners ===\nOld Member's Reference No\tMember's Reference No\tEmployer Code\tSex Code\tDate of Birth\tDate Became Pensioner\tCode For Previous Status\tType Of Retirement\tDate Of Exit From Active Service\tAnnual Pre-6.4.1988 GMP Component At Date Of Exit From Active Service\tAnnual Post-5.4.1988 GMP Component At Date Of Exit From Active Service\tAnnual Pre-6.4.1988 GMP Component At Date Of This Valuation\tAnnual Post-5.4.1988 GMP Component At Date Of This Valuation\tTotal Pension Payable From Scheme At Last Valuation\tTotal Pension Payable From Scheme At This Valuation\tComponent Of Pension At This Valuation Subject To RPI capped at 5% pa (or CPI capped at 5% pa for Section B members)\tContingent Widow(er)'s Sex Code\tContingent Widow(er)'s Date Of Birth\tContingent Widow(er)'s Pension At This Valuation\tComponent Of Contingent Widow(er)'s Pension At This Valuation Subject To RPI capped at 5% pa (or CPI capped at 5% pa for Section B members)\tDate Of Exit From Pensioner Status\tCode For Exit From Pensioner Status\tOld Supplementary Fund Indicator\tMarried Indicator\tOld Supplementary Fund Pension\tComponent Of Pension At This Valuation Subject To RPI capped at 2.5% pa\tComponent Of Contingent Widow(er)'s Pension At This Valuation Subject To RPI capped at 2.5% pa\tNon-increasing pension\tNon-increasing TV-in pension\tComponent Of Pension At This Valuation Subject To CPI capped at 2.5% pa (or fixed 5% pa for former Section B members)\tComponent Of Contingent Widow(er)'s Pension At This Valuation Subject To CPI capped at 2.5% pa (or fixed 5% pa for former Section B members)\tTotal Pension Payable From Scheme At Retirement Before Reduction for Tax Free Cash\tTax Free Cash taken at Retirement\tPension Commuted At Retirement in Exchange for Tax Free Cash\tTotal Pension Payable From Scheme At Retirement After Reduction for Tax Free Cash\tPostcode\tStatus\tSection B Indicator\n33297\t133297\tMNM\tF\t1962-03-05 00:00:00\t2022-03-05 00:00:00\tD\tPN\t1992-03-13 00:00:00\t421.2\t184.08\t3430.32\t1499.28\t\t7882.44\t\t\t\t749.64\t\t\t\t\tY\t\t\t\t\t\t2952.84\t0\t10167.17\t52549.42\t2284.73\t7882.44\t\tPN\tN\n33381\t133381\tMNM\tF\t1962-03-19 00:00:00\t2022-03-19 00:00:00\tD\tPN\t1985-06-18 00:00:00\t174.72\t0\t3036.8\t\t\t3036.8\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0\t0\t3036.8\t0\t0\t3036.8\t\tPN\tN\n33546\t133546\tMNM\tF\t1961-12-24 00:00:00\t2021-12-24 00:00:00\tD\tPN\t1985-06-18 00:00:00\t131.56\t0\t2286.48\t\t\t2286.48\t\t\t1959-07-05 00:00:00\t0\t\t\t\t\tY\t\t\t\t\t\t0\t0\t2286.48\t\t\t\t\tPN\tN\n=== Sheet: Active deferreds ===\nValuation Record Type\tMember's Reference No\tEmployer Code\tBenefits Scale Code\tSex Code\tDate Of Birth\tDate Pensionable Service Commenced\tDate Became Active Deferred Member\tCode For Previous Status\tNormal Retirement Date\tAnnual Pre-6.4.1988 GMP Component At Date Became Active Deferred Member\tAnnual Post-5.4.1988 GMP Component At Date Became Active Deferred Member\tTotal Deferred Pension Payable From Scheme At Date Became Active Deferred Member\tTotal Contingent Widow(er) Pension Payable From Scheme At Date Became Active Deferred Member\tExcess Component Of Deferred Pension At Date Became Active Deferred Member Subject To Statutory Revaluation In Deferment And CPI capped at 2.5% pa in payment\tExcess Component Of Deferred Pension At Date Became Active Deferred Member Subject To Both Statutory Revaluation In Deferment And RPI capped at 5% pa in payment\tMember's Total Normal Contributions With Interest To The Date Of This Valuation\tDate Of Exit From Active Deferred Member Status\tCode For Exit From Active Deferred Member Status\tContingent Widow(er)'s Pension Subject To RPI capped at 5% pa At Date Became Active Deferred Member\tEarly Vesting Age\tContingent Spouse's Benefit Marker\tOld Supplementary Fund Indicator\tSpouse's Date of Birth\tMarried Indicator\tOld Supplementary Fund Pension\tNew Pension Date\tExcess Component Of Deferred Pension At Date Became Active Deferred Member Subject To LPI5 Revaluation In Deferment And RPI capped at 2.5% pa in payment\tExcess Component Of Deferred Pension At Date Became Active Deferred Member Subject To LPI2.5 Revaluation In Deferment And RPI capped at 2.5% pa in payment\tContingent Widow(er)'s Pension Subject To RPI capped at 2.5% pa At Date Became Active Deferred Member\tContingent Widow(er)'s Pension Subject To CPI capped at 2.5% pa At Date Became Active Deferred Member\tPostcode\tDate Of Buy-Out Of SBO Terms\tDeferred Pension For Service To Buy-Out at this valuation date\tAnnual Post-5.4.1988 up to 31.5.1995 GMP Component At Date Of This Valuation\tFinal salary: Final Pensionable Salary At Exit From Active Status\nAD\t134226\tMNM\t\tM\t1964-06-10 00:00:00\t1984-01-03 00:00:00\t2018-09-30 00:00:00\tA\t2024-06-07 00:00:00\t435.76\t1357.2\t41547.81\t20773.9\t14059.53\t12856.81\t\t\t\t6428.4\t\t1 Full half rate spouse's benefit (or 2/3 if XYZ member)\tN\t\t\t\t2025-12-07 00:00:00\t1502.59\t11335.92\t6419.26\t7029.76\t\t\t\t\t71784.85\nAD\t134227\tMNM\t\tM\t1959-05-14 00:00:00\t1986-04-01 00:00:00\t2018-09-30 00:00:00\tA\t2019-05-11 00:00:00\t473.72\t1670.24\t33863.94\t16931.97\t9327.75\t11040.45\t\t\t\t5520.22\t\t1 Full half rate spouse's benefit (or 2/3 if XYZ member)\tN\t\t\t\t2020-11-11 00:00:00\t1414.53\t9937.25\t5675.89\t4663.87\t\t\t\t\t62102.51\nAD\t134228\tMNM\t\tM\t1962-01-25 00:00:00\t1989-10-16 00:00:00\t2018-09-30 00:00:00\tA\t2022-01-22 00:00:00\t1201.72\t907.4\t20946.17\t10473.08\t5298.19\t6422.83\t\t\t\t3211.41\t\t1 Full half rate spouse's benefit (or 2/3 if XYZ member)\tN\t\t\t\t2023-07-22 00:00:00\t898.32\t6217.71\t3558.02\t2649.09\t\t\t\t\t38368.81\n=== Sheet: Deferreds ===\nValuation Record Type\tMember's Reference No\tEmployer Code\tBenefits Scale Code\tSex Code\tDate Of Birth\tDate Pensionable Service Commenced\tDate Became Deferred Pensioner\tCode For Previous Status\tNormal Retirement Date\tAnnual Pre-6.4.1988 GMP Component At Date Became Deferred Pensioner\tAnnual Post-5.4.1988 GMP Component At Date Became Deferred Pensioner\tTotal Deferred Pension Payable From Scheme At Date Became Deferred Pensioner\tTotal Contingent Widow(er) Pension Payable From Scheme At Date Became Deferred Pensioner\tExcess Component Of Deferred Pension At Date Became Deferred Pensioner Not Subject To Statutory Revaluation In Deferment\tExcess Component Of Deferred Pension At Date Became Deferred Pensioner Subject To Statutory Revaluation In Deferment And CPI capped at 2.5% pa in payment (or fixed 5% pa in deferment and in payment for former Section B)\tExcess Component Of Deferred Pension At Date Became Deferred Pensioner Subject To Both Statutory Revaluation In Deferment And RPI capped at 5% pa in payment (or fixed 5% in deferment and CPI capped at 5% pa in payment for Section B members)\tMember's Total Normal Contributions With Interest To The Date Of This Valuation\tDate Of Exit From Deferred Pensioner Status\tCode For Exit From Deferred Pensioner Status\tVSS Current Pension Including GMP\tContingent Widow(er)'s Pension Subject To RPI capped at 5% pa At Date Became Deferred Pensioner\tEarly Vesting Age\tContingent Spouse's Benefit Marker\tOld Supplementary Fund Indicator\tSpouse's Date of Birth\tMarried Indicator\tOld Supplementary Fund Pension\tNew Pension Date\tExcess Component Of Deferred Pension At Date Became Deferred Pensioner Subject To LPI5 Revaluation In Deferment And RPI capped at 2.5% pa in payment (or fixed 5% in deferment and CPI capped at 2.5% pa in payment for Section B members)\tExcess Component Of Deferred Pension At Date Became Deferred Pensioner Subject To LPI2.5 Revaluation In Deferment And RPI capped at 2.5% pa in payment\tContingent Widow(er)'s Pension Subject To RPI capped at 2.5% pa At Date Became Deferred Pensioner\tSection B indicator\tTV-in fixed Paid Up Pension at Normal Retirement Date\tContingent Widow(er)'s Pension Subject To CPI capped at 2.5% pa At Date Became Deferred Pensioner (or fixed 5% pa for former Section B members)\tPostcode\tSalary at date of leaving pensionable service\tSection B Pre 21 July 1997 (Post 97 fixed 5% pa in deferment and payment pension)\nD\t33226\tXYZ\t\tF\t1966-05-25 00:00:00\t1993-06-28 00:00:00\t1995-08-31 00:00:00\tA\t2026-05-25 00:00:00\t\t55.12\t321.28\t0\t\t266.16\t\t\t\t\t\t\t\t1 Full half rate spouse's benefit (or 2/3 if XYZ member)\t\t\tY\t\t\t\t\t\tN\t\t133.08\t\t\t0\nD\t33256\tXYZ\t\tF\t1973-07-27 00:00:00\t1991-10-31 00:00:00\t1996-11-29 00:00:00\tA\t2033-07-27 00:00:00\t\t157.04\t918.13\t0\t\t761.09\t\t\t\t\t\t\t\t1 Full half rate spouse's benefit (or 2/3 if XYZ member)\t\t\tN\t\t\t\t\t\tN\t\t380.55\t\t\t0\nD\t33257\tXYZ\t\tM\t1971-05-27 00:00:00\t1990-12-03 00:00:00\t1995-08-31 00:00:00\tA\t2031-05-27 00:00:00\t\t200.72\t939.32\t0\t\t738.6\t\t\t\t\t\t\t\t1 Full half rate spouse's benefit (or 2/3 if XYZ member)\t\t\tN\t\t\t\t\t\tN\t\t369.3\t\t\t0\n=== Sheet: Pensioners ===\nMember's Reference No\tEmployer Code\tSex Code\tDate Of Birth\tDate Became Pensioner\tCode For Previous Status\tType Of Retirement\tDate Of Exit From Active Service\tAnnual Pre-6.4.1988 GMP Component At Date Of Exit From Active Service\tAnnual Post-5.4.1988 GMP Component At Date Of Exit From Active Service\tAnnual Pre-6.4.1988 GMP Component At Date Of This Valuation\tAnnual Post-5.4.1988 GMP Component At Date Of This Valuation\tTotal Pension Payable From Scheme At Last Valuation\tTotal Pension Payable From Scheme At This Valuation\tComponent Of Pension At This Valuation Subject To RPI capped at 5% pa (or CPI capped at 5% pa for Section B members)\tContingent Widow(er)'s Sex Code\tContingent Widow(er)'s Date Of Birth\tContingent Widow(er)'s Pension At This Valuation\tComponent Of Contingent Widow(er)'s Pension At This Valuation Subject To RPI capped at 5% pa (or CPI capped at 5% pa for Section B members)\tDate Of Exit From Pensioner Status\tCode For Exit From Pensioner Status\tOld Supplementary Fund Indicator\tMarried Indicator\tOld Supplementary Fund Pension\tComponent Of Pension At This Valuation Subject To RPI capped at 2.5% pa\tComponent Of Contingent Widow(er)'s Pension At This Valuation Subject To RPI capped at 2.5% pa\tNon-increasing pension\tNon-increasing TV-in pension\tComponent Of Pension At This Valuation Subject To CPI capped at 2.5% pa (or fixed 5% pa for former Section B members)\tComponent Of Contingent Widow(er)'s Pension At This Valuation Subject To CPI capped at 2.5% pa (or fixed 5% pa for former Section B members)\tTotal Pension Payable From Scheme At Retirement Before Reduction for Tax Free Cash\tTax Free Cash taken at Retirement\tPension Commuted At Retirement in Exchange for Tax Free Cash\tTotal Pension Payable From Scheme At Retirement After Reduction for Tax Free Cash\tPostcode\tStatus\tSection B Indicator\n33297\tXYZ\tF\t1962-03-02 00:00:00\t2022-03-02 00:00:00\tD\tPN\t1992-03-13 00:00:00\t421.2\t184.08\t3430.32\t1499.28\t\t7882.44\t\t\t\t749.64\t\t\t\t\tY\t\t\t\t\t\t2952.84\t0\t10167.17\t52549.42\t2284.73\t7882.44\t\tPN\tN\n33381\tXYZ\tF\t1962-03-16 00:00:00\t2022-03-16 00:00:00\tD\tPN\t1985-06-18 00:00:00\t174.72\t0\t3036.8\t\t\t3036.8\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t0\t0\t3036.8\t0\t0\t3036.8\t\tPN\tN\n33546\tXYZ\tF\t1961-12-21 00:00:00\t2021-12-21 00:00:00\tD\tPN\t1985-06-18 00:00:00\t131.56\t0\t2286.48\t\t\t2286.48\t\t\t1959-07-05 00:00:00\t0\t\t\t\t\tY\t\t\t\t\t\t0\t0\t2286.48\t\t\t\t\tPN\tN\n=== Sheet: Widows ===\nValuation Record Type\tWidow(er)'s Reference No\tDeceased Member's Reference No\tBeneficiary's Code\tWidow(er)'s Date Of Birth\tDate Became Widow(er) Beneficiary\tCode For Previous Status Of Deceased Member\tDate Deceased Member Became Pensioner\tWidow(er)'s Annual Pre-6.4.1988 GMP Component At Date Of This Valuation\tWidow(er)'s Annual Post-5.4.1988 GMP Component At Date Of This Valuation\tTotal Widow(er)'s Pension Payable From Scheme At This Valuation\tTotal Widow(er)'s Pension Payable From Scheme At Last Valuation\tComponent Of Widow(er)'s Pension At This Valuation Subject To RPI capped at 5% pa\tDate Of Exit From Widow(er) Beneficiary Status\tCode For Exit From Widow(er) Beneficiary Status\tWidow's Allotment At Valuation Date Included In Pension\tOld Supplementary Fund Indicator\tOld Supplementary Fund Pension\tComponent Of Widow(er)'s Pension At This Valuation Subject To RPI capped at 2.5% pa\tSection B Indicator\tComponent Of Widow(er)'s Pension At This Valuation Subject To CPI capped at 2.5% pa\tPostcode\nW\t70642\t70642\t1\t1964-05-18 00:00:00\t2021-08-01 00:00:00\tPN\t2021-05-05 00:00:00\t\t828.72\t3557.04\t\t66.24\t\t\t\t\t\t\t\t2662.08\t\nW\t70655\t70655\t2\t1966-01-12 00:00:00\t2021-12-01 00:00:00\tPN\t2021-08-09 00:00:00\t\t63.84\t1294.44\t\t993.84\t\t\t\t\t\t\t\t236.76\t\nW\t70656\t70656\t1\t1951-04-13 00:00:00\t2022-03-01 00:00:00\tPN\t1998-12-31 00:00:00\t1412.64\t1096.08\t11601.48\t\t1692.72\t\t\t\t\t\t\t\t7400.04\t\n=== Sheet: Children ===\nValuation Record Type\tChild's Reference No\tDeceased members reference no\tChild's Date of Birth\tDate Child'sPension Commenced\tCode For Previous Status Of Deceased Member\tChild's Pension Payable From Scheme At This Valuation\tComponent Of Child's Pension At This Valuation Subject To RPI capped at 5% pa\tDate Child's Pension Is To Cease Or Has Ceased\tOld Supplementary Fund Indicator\tOld Supplementary Fund Pension\tSection B Indicator\tComponent Of Child's Pension At This Valuation Subject To RPI capped at 2_5% pa\tComponent of Child\u2019s Pension At This Valuation Subject to CPI capped at 2_5% pa\nC\t70643\t37387\t2006-04-05 00:00:00\t2021-08-01 00:00:00\tP\t1182.72\t22.2\t\tN\t\tN\t0\t1160.52\nC\t70674\t41653\t2010-09-16 00:00:00\t2022-08-01 00:00:00\tD\t596.16\t596.16\t\tN\t\tN\t0\t"
  }
]

Fields to extract:
[
  {
    "field_id": "afca5391-afb0-4639-baff-2b69487669ad",
    "name": "Worksheet",
    "description": "The name of the worksheet containing the column. This should only look at row 1 in each sheet.",
    "property_type": "TEXT",
    "auto_verification_confidence": 80,
    "choice_options": [],
    "is_identifier": false,
    "order_index": 1,
    "collection_id": "ee9d75f7-026e-4f59-ad7a-329295c54505",
    "type": "collection_property"
  }
]

Existing Excel Wizardry Functions:
[
  {
    "id": "5cb27213-baeb-4c83-8acd-8033f04978b9",
    "name": "extract_excel_data",
    "description": "Advanced multi-line parsing: Handles complex headers with intelligent continuation detection and data boundary identification",
    "tags": [
      "Excel",
      "Data Extraction",
      "Column Headings",
      "Spreadsheet"
    ],
    "function_code": "def extract_excel_data(extracted_content, target_fields_data):\n    results = []\n    record_index = 0\n    \n    # Define separator characters to avoid f-string backslash issues\n    tab_char = \"\\t\"\n    newline_char = \"\\n\"\n    \n    print(f\"DEBUG - Full content length: {len(extracted_content)} characters\")\n    print(f\"DEBUG - Content has {extracted_content.count(tab_char)} tab characters\")\n    \n    # Split by sheets\n    if \"=== Sheet:\" in extracted_content:\n        sheets = extracted_content.split(\"=== Sheet:\")\n    else:\n        sheets = [extracted_content]\n    \n    for sheet_idx, sheet_part in enumerate(sheets):\n        if not sheet_part.strip():\n            continue\n            \n        lines = sheet_part.strip().split(newline_char)\n        if not lines:\n            continue\n            \n        # Get sheet name\n        sheet_name = f\"Sheet_{sheet_idx}\"\n        if lines and \"===\" in lines[0]:\n            sheet_name = lines[0].replace(\"===\", \"\").strip()\n            lines = lines[1:]\n        \n        print(f\"DEBUG - Processing sheet: {sheet_name}\")\n        print(f\"DEBUG - Sheet has {len(lines)} lines\")\n        \n        # Advanced multi-line header reconstruction\n        header_lines = []\n        data_start_idx = -1\n        \n        # Find where data starts (first line with numeric/code pattern)\n        for idx, line in enumerate(lines):\n            if line.strip():\n                # Check if this looks like data (starts with number, has many tabs)\n                stripped = line.strip()\n                if (stripped and \n                    (stripped[0].isdigit() or \n                     (len(stripped) > 5 and stripped[:6].replace(\"-\", \"\").replace(\":\", \"\").isdigit())) and\n                    line.count(tab_char) > 20):  # Has many columns like data\n                    data_start_idx = idx\n                    break\n        \n        if data_start_idx == -1:\n            # No clear data found, assume all lines are header\n            header_lines = [line for line in lines if line.strip()]\n        else:\n            # Everything before data is header\n            header_lines = lines[:data_start_idx]\n        \n        print(f\"DEBUG - Using {len(header_lines)} lines for header reconstruction\")\n        print(f\"DEBUG - Data starts at line {data_start_idx}\")\n        \n        # Reconstruct the complete header by intelligently joining lines\n        if not header_lines:\n            print(f\"DEBUG - No header lines found in {sheet_name}\")\n            continue\n            \n        # Method 1: If first line has many tabs, it's likely the main header\n        main_header_line = None\n        for line in header_lines:\n            if line.count(tab_char) > 10:  # Likely the main header line\n                main_header_line = line\n                break\n        \n        if not main_header_line:\n            # Method 2: Take the longest line as main header\n            main_header_line = max(header_lines, key=len, default=\"\")\n        \n        # Method 3: Rebuild header by joining continuation pieces\n        reconstructed_header = main_header_line\n        \n        # Look for continuation patterns in other header lines\n        for line in header_lines:\n            if line != main_header_line and line.strip():\n                line_clean = line.strip()\n                \n                # If this line has fewer tabs and looks like continuation text\n                if (line.count(tab_char) < main_header_line.count(tab_char) / 2 and\n                    len(line_clean) > 10 and\n                    not line_clean[0].isdigit()):\n                    \n                    # This might be continuation text, try to merge it\n                    print(f\"DEBUG - Potential continuation: {line_clean[:50]}...\")\n                    \n                    # Try to intelligently place continuation text\n                    # Split main header to find where this continuation belongs\n                    parts = reconstructed_header.split(tab_char)\n                    \n                    # Look for incomplete parts (common patterns for incomplete headers)\n                    for i, part in enumerate(parts):\n                        if (part.strip().endswith(\"(or\") or \n                            part.strip().endswith(\"And\") or\n                            part.strip().endswith(\"Subject To\") or\n                            part.strip().endswith(\"pa\") or\n                            part.strip().endswith(\"for\") or\n                            len(part.strip()) > 50 and not part.strip().endswith(\")\")):\n                            \n                            # This part looks incomplete, append continuation\n                            parts[i] = part.rstrip() + \" \" + line_clean\n                            reconstructed_header = tab_char.join(parts)\n                            print(f\"DEBUG - Merged continuation into column {i}\")\n                            break\n        \n        # Split the final reconstructed header\n        header_row = reconstructed_header.split(tab_char)\n        \n        # Clean up each header\n        cleaned_headers = []\n        for header in header_row:\n            if header:\n                # Remove internal newlines and clean up spacing\n                clean_header = header.replace(newline_char, \" \").strip()\n                # Fix common formatting issues\n                clean_header = \" \".join(clean_header.split())  # Normalize whitespace\n                cleaned_headers.append(clean_header)\n            else:\n                cleaned_headers.append(\"\")\n        \n        print(f\"DEBUG - Final header with {len(cleaned_headers)} total columns\")\n        print(f\"DEBUG - First 3 columns: {cleaned_headers[:3]}\")\n        print(f\"DEBUG - Last 3 columns: {cleaned_headers[-3:] if len(cleaned_headers) > 3 else cleaned_headers}\")\n        \n        # Show sample of longest headers (likely the problematic ones)\n        long_headers = [(i, h) for i, h in enumerate(cleaned_headers) if len(h) > 60]\n        if long_headers:\n            print(f\"DEBUG - Long headers found: {len(long_headers)} headers >60 chars\")\n            for i, (idx, header) in enumerate(long_headers[:3]):  # Show first 3 long ones\n                print(f\"DEBUG - Long header {idx}: {header}\")\n        \n        # Find the target field for column headings\n        column_field = None\n        collection_name = \"ExcelData\"\n        \n        for field in target_fields_data:\n            prop_name = field.get(\"property_name\", \"\").lower()\n            if \"column\" in prop_name and \"heading\" in prop_name:\n                column_field = field\n                collection_name = field.get(\"collection_name\", \"ExcelData\")\n                break\n        \n        # Process ALL columns in the cleaned header\n        for col_idx, header in enumerate(cleaned_headers):\n            # Create header text\n            if header and header.strip():\n                header_clean = header.strip()\n            else:\n                header_clean = f\"Column_{col_idx + 1}\"\n            \n            # Create result for every column position\n            if column_field:\n                field_name_full = f\"{collection_name}.{column_field.get('property_name', 'Column_Heading')}[{record_index}]\"\n                data_type = column_field.get(\"property_type\", \"TEXT\")\n            else:\n                field_name_full = f\"{collection_name}.Column_Heading[{record_index}]\"\n                data_type = \"TEXT\"\n            \n            results.append({\n                \"validation_type\": \"collection_property\",\n                \"data_type\": data_type,\n                \"field_name\": field_name_full,\n                \"collection_name\": collection_name,\n                \"extracted_value\": header_clean,\n                \"confidence_score\": 0.95 if header and header.strip() else 0.80,\n                \"validation_status\": \"unverified\",\n                \"ai_reasoning\": f\"Advanced multi-line header {col_idx + 1} from {sheet_name}\",\n                \"record_index\": record_index\n            })\n            \n            record_index += 1\n        \n        print(f\"DEBUG - Extracted {len(cleaned_headers)} columns from {sheet_name} with advanced parsing\")\n    \n    print(f\"DEBUG - Total header columns extracted: {len(results)}\")\n    return results",
    "usage_count": 24
  }
]

Identifier References from Previous Extraction:
None - First extraction

Extraction Number: 1

Based on the document format and target fields, determine which extraction process to use:

1. If format is Excel, ALWAYS prefer "Excel Wizardry Function" for intelligent extraction:
   - If we have existing functions that match similar document types or field patterns, use: "Excel Wizardry Function|<function_id>"
   - If no matching functions exist or you want to create a new optimized function, use: "Excel Wizardry Function|CREATE_NEW"
2. For non-Excel formats (Word/PDF), return: "AI Extraction"

IMPORTANT: Excel Wizardry Function is the preferred method for ALL Excel documents as it provides intelligent, reusable extraction logic.

SUBSEQUENT EXTRACTIONS: If identifier_references are provided and extraction_number > 0, the extraction process will use the identifier data from previous extractions to target specific records.

Response format:
- For existing function: "Excel Wizardry Function|<function_id>"
- For new function: "Excel Wizardry Function|CREATE_NEW"
- For non-Excel: "AI Extraction"