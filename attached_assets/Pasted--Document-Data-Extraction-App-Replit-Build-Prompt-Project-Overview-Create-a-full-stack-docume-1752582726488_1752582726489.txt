# Document Data Extraction App - Replit Build Prompt

## Project Overview
Create a full-stack document data extraction application using AI to extract structured data from PDF/Excel documents. The app should allow users to configure extraction schemas, upload documents, review AI-extracted data, and manage extraction sessions.

## Tech Stack Requirements
- **Backend**: Python with FastAPI
- **Frontend**: React with TypeScript and Tailwind CSS
- **Database**: SQLite (for development) with SQLAlchemy ORM
- **AI Integration**: Google Gemini API for document extraction
- **File Storage**: Local file system (development) with plans for Google Cloud Storage

## Core Features to Implement

### 1. Project Management
- Create/edit/delete projects
- Each project has configurable data schema and extraction rules
- Project dashboard with tiles showing statistics

### 2. Enhanced Data Schema Configuration
- **Project Schema**: Global fields that apply to entire document set (e.g., Company Name, Scheme Type)
- **Object Collections**: Define object types with properties that create multiple records
  - Collection Name & Description (e.g., "Employees", "Trustees", "Contracts")
  - Collection Properties with name, type, and description
  - Support field types: TEXT, NUMBER, DATE, BOOLEAN
  - Each collection becomes a separate data table in extraction results

### 3. Knowledge & Rules Management
- Upload reference documents (policies, standards, guidelines)
- Create custom extraction rules categorized as:
  - Data Validation
  - Classification 
  - Data Formatting
  - Business Logic

### 4. Document Upload & AI Extraction
- Upload multiple documents (PDF, DOCX, XLSX)
- AI processes documents using schema and object collections
- Display extraction results with visual status indicators:
  - ✅ Green checkmark for successfully extracted fields
  - ⚠️ Red warning for missing/failed extractions with AI reasoning tooltips
- Allow manual editing of extracted data
- Support incremental extraction (upload more docs to fill missing fields)

### 5. Enhanced Data Review & Verification
- Project data displayed at top of interface
- Each object collection shown as separate data tables/sheets
- Tabbed interface for multiple collections
- Editable fields with validation across all collections
- Verify complete datasets and save with "Verified" status
- View all extraction sessions with progress tracking

## Enhanced Database Schema

```sql
-- Projects table
CREATE TABLE projects (
    id INTEGER PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Project schema fields (global data points)
CREATE TABLE project_schema_fields (
    id INTEGER PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id),
    field_name VARCHAR(255) NOT NULL,
    field_type VARCHAR(50) NOT NULL, -- TEXT, NUMBER, DATE, BOOLEAN
    description TEXT,
    order_index INTEGER
);

-- Object Collections (replacing record schema)
CREATE TABLE object_collections (
    id INTEGER PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id),
    collection_name VARCHAR(255) NOT NULL,
    description TEXT,
    order_index INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Collection Properties (properties of each object type)
CREATE TABLE collection_properties (
    id INTEGER PRIMARY KEY,
    collection_id INTEGER REFERENCES object_collections(id),
    property_name VARCHAR(255) NOT NULL,
    property_type VARCHAR(50) NOT NULL, -- TEXT, NUMBER, DATE, BOOLEAN
    description TEXT,
    order_index INTEGER
);

-- Knowledge documents
CREATE TABLE knowledge_documents (
    id INTEGER PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id),
    filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500),
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Extraction rules
CREATE TABLE extraction_rules (
    id INTEGER PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id),
    rule_name VARCHAR(255) NOT NULL,
    category VARCHAR(100) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Extraction sessions
CREATE TABLE extraction_sessions (
    id INTEGER PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id),
    status VARCHAR(50) DEFAULT 'in_progress', -- in_progress, verified
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Uploaded documents per session
CREATE TABLE session_documents (
    id INTEGER PRIMARY KEY,
    session_id INTEGER REFERENCES extraction_sessions(id),
    filename VARCHAR(255),
    file_path VARCHAR(500),
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Extracted project data
CREATE TABLE extracted_project_data (
    id INTEGER PRIMARY KEY,
    session_id INTEGER REFERENCES extraction_sessions(id),
    field_name VARCHAR(255),
    field_value TEXT,
    extraction_status VARCHAR(50), -- extracted, manual, missing
    ai_reasoning TEXT
);

-- Extracted object records (replacing extracted_records)
CREATE TABLE extracted_object_records (
    id INTEGER PRIMARY KEY,
    session_id INTEGER REFERENCES extraction_sessions(id),
    collection_id INTEGER REFERENCES object_collections(id),
    record_index INTEGER, -- For distinguishing multiple instances of same object type
    property_name VARCHAR(255),
    property_value TEXT,
    extraction_status VARCHAR(50), -- extracted, manual, missing
    ai_reasoning TEXT
);
```

## Enhanced API Endpoints Structure

```python
# Main API routes to implement
/api/projects/                          # GET, POST - List/create projects
/api/projects/{id}                     # GET, PUT, DELETE - Project CRUD
/api/projects/{id}/schema              # GET, POST - Manage project schema fields
/api/projects/{id}/collections         # GET, POST - Manage object collections
/api/collections/{id}/properties       # GET, POST - Manage collection properties
/api/projects/{id}/rules               # GET, POST - Manage extraction rules
/api/projects/{id}/knowledge           # GET, POST - Manage knowledge docs
/api/projects/{id}/sessions            # GET, POST - List/create sessions
/api/sessions/{id}                     # GET, PUT - Session details
/api/sessions/{id}/upload              # POST - Upload documents
/api/sessions/{id}/extract             # POST - Trigger AI extraction
/api/sessions/{id}/verify              # POST - Verify session data
```

## Enhanced Frontend Components Structure

```
src/
├── components/
│   ├── Dashboard/
│   │   └── ProjectTiles.tsx
│   ├── Project/
│   │   ├── ProjectLayout.tsx
│   │   ├── NewUpload.tsx
│   │   ├── AllData.tsx
│   │   ├── KnowledgeRules.tsx
│   │   └── DefineData.tsx
│   ├── Schema/
│   │   ├── ProjectSchemaForm.tsx
│   │   ├── ObjectCollectionForm.tsx
│   │   ├── CollectionPropertyForm.tsx
│   │   └── SchemaField.tsx
│   ├── Extraction/
│   │   ├── DataExtractionForm.tsx
│   │   ├── ProjectDataSection.tsx
│   │   ├── ObjectCollectionTabs.tsx
│   │   └── CollectionDataTable.tsx
│   ├── Forms/
│   │   ├── RuleForm.tsx
│   │   └── DocumentUpload.tsx
│   └── UI/
│       ├── StatusIndicator.tsx
│       ├── FileUpload.tsx
│       ├── DataTable.tsx
│       └── TabInterface.tsx
├── pages/
│   ├── Dashboard.tsx
│   └── ProjectView.tsx
├── hooks/
│   ├── useProjects.ts
│   ├── useCollections.ts
│   ├── useExtraction.ts
│   └── useDocuments.ts
└── services/
    └── api.ts
```

## Key Implementation Notes

1. **Object-Aware AI Integration**: Format project schema + object collections into structured prompts for Gemini API
2. **Multi-Collection Interface**: Tabbed interface showing project data + each collection as separate tables
3. **File Handling**: Support PDF text extraction, Excel parsing, and Word document processing
4. **Collection-Based Status Management**: Track extraction status per property within each collection
5. **Incremental Processing**: Re-extract missing/failed fields across all collections when new documents added
6. **Responsive Design**: Use Tailwind CSS with clean, modern interface matching wireframes
7. **Comprehensive Error Handling**: User-friendly messages with collection-specific context

## Enhanced Development Priorities
1. Start with basic project CRUD and project schema management
2. Implement object collections and properties management
3. Add file upload and storage
4. Build collection-aware AI extraction service (mock initially, then integrate Gemini)
5. Create tabbed data review interface with multiple collection tables
6. Add knowledge/rules management
7. Implement session management and verification across all collections

## Enhanced Mock Data for Testing
Include sample pension scheme data with multiple object types:
- **Project Data**: Company "ABC Corporation Ltd", Scheme Type "Defined Benefit"
- **Employees Collection**: John Smith, Sarah Johnson, Michael Brown with full employee data
- **Trustees Collection**: Board members with names, roles, appointment dates
- **Assets Collection**: Investment holdings with types, values, allocation percentages
- Sample PDF/Excel files with pension data across multiple object types

Please create a fully functional application following this specification, ensuring the UI matches the modern, clean design shown in the wireframes with proper navigation, status indicators, and user-friendly interactions.