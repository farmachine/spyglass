# Document Data Extraction App - Design Specification

## Terminology & Data Structure

### Core Entities
- **Project**: A data extraction configuration for a specific type of document/process
- **Extraction Session**: A single upload and extraction instance within a project
- **Project Schema**: Global data points that apply to the entire document set
- **Object Collections**: Defined object types with their properties that create repeating records

### Data Model
```
Project
├── Project Schema (1:many)
│   ├── Field Name
│   ├── Field Type (TEXT, DATE, NUMBER, BOOLEAN)
│   └── Field Description
├── Object Collections (1:many)
│   ├── Collection Name (e.g., "Employees", "Trustees", "Contracts")
│   ├── Collection Description
│   └── Collection Properties (1:many)
│       ├── Property Name
│       ├── Property Type
│       └── Property Description
├── Knowledge Base (1:many)
│   ├── Document Rules
│   └── Text Rules
└── Extraction Sessions (1:many)
    ├── Uploaded Documents
    ├── Extracted Project Data
    ├── Extracted Object Collections
    └── Status (In Progress, Verified)
```

## Enhanced Object Collections Concept

### What Are Object Collections?
Object Collections allow users to define **types of objects** they want to extract from documents, rather than just individual fields. Each collection represents a class of objects with defined properties.

**Examples:**
- **Employees Collection**: Name, DOB, Salary, Years of Service, Pension Contribution
- **Trustees Collection**: Name, Role, Appointment Date
- **Contracts Collection**: Contract Number, Start Date, End Date, Value, Terms
- **Assets Collection**: Asset Type, Value, Location, Purchase Date

### Benefits:
1. **Semantic Understanding**: AI understands relationships between properties
2. **Flexible Schema**: Easy to add new object types without restructuring
3. **Natural Data Organization**: Matches how humans think about document content
4. **Scalable Extraction**: Can handle documents with multiple object types

## Application Flow

### 1. Project Management Level
- Dashboard showing all projects as tiles
- Create new project functionality
- Duplicate/Delete existing projects

### 2. Project Level Workflow
**Navigation Tabs (Left Sidebar):**
1. **New Upload** → Upload documents and extract data
2. **All Data** → View all extraction sessions for this project
3. **Knowledge/Rules** → Define extraction rules and knowledge
4. **Define Data** → Configure project schema and object collections

### 3. Enhanced Data Extraction Process
1. **Upload Documents** → AI extracts data based on project schema and object collections
2. **Review & Edit** → Verify extracted project data and object collection records
3. **Add More Documents** → Upload additional documents for missing data
4. **Verify** → Mark complete extraction session as verified

## Enhanced User Story

**Context**: Jenny works with pension scheme data extraction for insurance providers.

**Setup Phase**:
1. Jenny creates a new "Pension Scheme Analysis" project
2. She defines the Project Schema (scheme-level data like Company Name, Scheme Type, etc.)
3. She creates Object Collections:
   - **Employees Collection**: Name, DOB, Salary, Years of Service, Pension Contribution
   - **Trustees Collection**: Name, Role, Appointment Date
   - **Beneficiaries Collection**: Name, Relationship, Benefit Amount
4. She uploads knowledge documents (pension regulations, data standards)

**Extraction Phase**:
1. Jenny uploads pension documents via "New Upload"
2. AI extracts:
   - Project-level data (company info, scheme details)
   - Multiple object collections (employees, trustees, beneficiaries)
3. Successfully extracted fields show green checkmarks
4. Missing/failed extractions show red indicators with AI reasoning
5. Jenny reviews AI reasoning to understand gaps

**Data Organization**:
- Project data displayed at top of form
- Each object collection shown as separate data tables/sheets
- Tab-based or accordion interface for multiple collections
- Clear visual separation between different object types

**Iteration Phase**:
1. Jenny requests additional documents from pension provider
2. She uploads new documents using "Add More Documents"
3. AI searches for missing data across all collections
4. More fields populate with green checkmarks

**Completion Phase**:
1. Jenny manually fills remaining gaps using email responses
2. She verifies the complete dataset (project data + all collections)
3. Extraction session moves to "Verified" status in "All Data" view

## Key Features

### Smart Object-Aware Extraction
- AI understands object types and their relationships
- Contextual reasoning for complex data points within object collections
- Incremental extraction (only missing data from new uploads)
- Cross-collection validation and consistency checks

### Enhanced User Interface
- Visual indicators for extraction status across all collections
- Tabbed or accordion interface for multiple object collections
- Editable fields with re-validation within each collection
- AI explanations for extraction failures by object type

### Flexible Project Configuration
- Reusable object collection templates
- Drag-and-drop property ordering within collections
- Multiple extraction sessions per project
- Status tracking and history across all object types

### Database Schema Enhancement
```sql
-- Object Collections
CREATE TABLE object_collections (
    id INTEGER PRIMARY KEY,
    project_id INTEGER REFERENCES projects(id),
    collection_name VARCHAR(255) NOT NULL,
    description TEXT,
    order_index INTEGER,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Collection Properties
CREATE TABLE collection_properties (
    id INTEGER PRIMARY KEY,
    collection_id INTEGER REFERENCES object_collections(id),
    property_name VARCHAR(255) NOT NULL,
    property_type VARCHAR(50) NOT NULL, -- TEXT, NUMBER, DATE, BOOLEAN
    description TEXT,
    order_index INTEGER
);

-- Extracted Object Records
CREATE TABLE extracted_object_records (
    id INTEGER PRIMARY KEY,
    session_id INTEGER REFERENCES extraction_sessions(id),
    collection_id INTEGER REFERENCES object_collections(id),
    record_index INTEGER, -- For distinguishing multiple instances
    property_name VARCHAR(255),
    property_value TEXT,
    extraction_status VARCHAR(50), -- extracted, manual, missing
    ai_reasoning TEXT
);
```